meta doc 'tests for core module'

use module test

bool test_bool_new() {
  b = bool.new()
  not b
}

bool test_bool_and() {
  true and true
}

bool test_string_eq_same() {
  'same' == 'same'
}

bool test_string_times_1() {
  'one' == 'one' * 1
}

bool test_string_times_2() {
  'oneone' == 'one' * 2
}

bool test_string_times_3() {
  'oneoneone' == 'one' * 3
}

bool test_string_length() {
   l = 'one'.length()
   l == 3
}

bool test_string_tail() {
  'ne' == tail('one')
}

bool test_string_head() {
  'o' == head('one')
}

bool test_string_at_0() {
  'o' == 'one'.at(0)
}

bool test_string_at_1() {
  'n' == 'one'.at(1)
}

bool test_ref_count_init() {
  _reflist.length() == 0
}

bool test_ref_count_add() {
  i = 10.ref() 
  _reflist.length() == 1
}

ref _make_ref() {
  i = 10.ref()
}

bool test_ref_deref() {
  i = 10.ref()
  i.deref() == 10
}

bool test_ref_count_import() {
  i = _make_ref()
  _reflist.length() == 1
}

bool test_list_new() {
  l = list.new()
  l.length() == 0
}

list _make_list() {
  l = list.new()
  l = l.push('one')
  l = l.push('two')
}

bool test_list_push() {
  l = _make_list()
  l.length() == 2
}

bool test_list_head() {
  l = _make_list()
  s = l.head()
  s == 'one'
}

bool test_list_eq_empty() {
  [] == []
}

bool test_list_eq_same() {
  ['one', 'two', 'three'] == ['one', 'two', 'three']
}

bool test_list_eq_different() {
  ['one', 'two', 'three'] != ['one', 'two']
}

bool test_list_tail() {
  l = _make_list()
  t = l.tail()
  t.at(0) == 'two'
}

bool test_list_length() {
  ['one', 'two', 'three'].length() == 3
}

bool test_fun_call() {
  f = int fun (int i) { 2 * i }
  f.call().with(2) == 4
}

bool test_list_map() {
  [0, 1, 2].map(int fun (int i) { 2 * i }) == [0, 2, 4]
}
