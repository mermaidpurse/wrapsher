module env
use module io

string _run_export(module/env m) {
  shell '''
  _wsh_result=string:"$(export -p)"
  '''
}

# TODO: filter valid lines
map to_map(module/env m) {
  out = env._run_export()
  lines = out.split('
')
  lines.map(pair fun (string s) {
        fields = s.split(' ')
        pair.from_kv(fields[1].split('='))
      }).as_map()
  }
}

string at(module/env m, string k) {
  out = env._run_export()
  lines = out.split('
')
  lines.map(pair 
}
